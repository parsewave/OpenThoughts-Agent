# Harbor eval configuration (16 concurrency, OpenHands, 32k context, TOOL CALLING ENABLED, SkyRL full setup)
#
# This config enables native OpenHands tool calling via the OpenAI function calling API,
# with BOTH instruction_override (SkyRL-Agent workflow) AND dockerfile_override (SkyRL environment setup).
#
# Key features:
#   - disable_tool_calls: false (enables native function calling)
#   - instruction_override: prepends SkyRL-Agent 9-phase workflow to all tasks
#   - dockerfile_override: appends SkyRL environment setup to all Dockerfiles
#
# Dockerfile override includes (from SkyRL-Agent utils.py:158-355):
#   - Git config for non-interactive operation
#   - PIP cache and git no-pager alias
#   - Search tools dependencies (chardet, networkx, rank-bm25)
#   - SWE-Bench utility directories
#
# Usage:
#   python -m hpc.launch \
#       --job_type eval \
#       --vllm_serve_config hpc/datagen_yaml/qwen3_coder_480b_vllm_serve_32k.yaml \
#       --harbor_yaml hpc/harbor_yaml/trace_16concurrency_openhands_eval_ctx32k_toolcall_skyrl_full.yaml \
#       ...

job_name: default-eval-job
jobs_dir: trace_jobs
n_attempts: 3
timeout_multiplier: 1.0
debug: false

# SkyRL-Agent workflow instruction override
# Prepends the structured 9-phase workflow to all task instructions
instruction_override:
  method: prepend
  path: chat_templates/skyrl_agent_swebench_workflow.md

# SkyRL-Agent environment dockerfile override
# Appends git config, search tool deps, and utility directories to all Dockerfiles
dockerfile_override:
  method: append
  path: docker/snippets/swebench/skyrl_full_setup.dockerfile

orchestrator:
  type: local
  n_concurrent_trials: 16
  quiet: false
  plain_output: true
  adaptive_concurrency:
    enabled: false
    algorithm: gradient2
    min_limit:
    max_limit:
    metrics_endpoint:
    metrics_timeout_sec: 10.0
    poll_interval_sec: 120.0
    window_size: 5
    queue_p95_drop_threshold:
    algorithm_kwargs: {}
  retry:
    max_retries: 10
    include_exceptions:
    exclude_exceptions:
    - AgentTimeoutError
    - VerifierTimeoutError
    wait_multiplier: 2.0
    min_wait_sec: 1.0
    max_wait_sec: 90.0
  kwargs: {}

environment:
  type: daytona
  force_build: true
  delete: true
  override_cpus: 1
  override_memory_mb: 2048
  override_storage_mb: 2048
  kwargs: {}

verifier:
  override_timeout_sec:
  max_timeout_sec:
  disable: false

metrics: []

agents:
- name: openhands
  import_path:
  model_name: placeholder/override-at-runtime
  max_timeout_sec:
  override_setup_timeout_sec: 600
  kwargs:
    # IMPORTANT: Tool calling ENABLED for native function calling
    # This requires the vLLM server to have enable_auto_tool_choice: true
    # and an appropriate tool_call_parser (e.g., hermes for Qwen3, qwen3_coder for Qwen3-Coder)
    disable_tool_calls: false

    collect_rollout_details: false
    collect_engine_metrics: false
    metrics_endpoint: https://replace-with-vllm-host/metrics
    metrics_timeout_sec: 10
    model_info:
      max_input_tokens: 32768
      max_output_tokens: 8192
      input_cost_per_token: 0
      output_cost_per_token: 0

    trajectory_config:
      raw_content: false  # Use events folder (structured tool calls) instead of raw completions
      linear_history: true

datasets:
- path: /replace/with/tasks/path

tasks: []
